From 95cc0b31b27d228d9748137a02ce2b0e6ff070b6 Mon Sep 17 00:00:00 2001
From: William Douglas <william.douglas@intel.com>
Date: Tue, 20 Mar 2018 20:17:19 +0000
Subject: [PATCH] CVE-2018-7549

Src/params.c: avoid crash copying empty hash table.
---
 Src/params.c | 11 +++++++----
 1 file changed, 7 insertions(+), 4 deletions(-)

diff --git a/Src/params.c b/Src/params.c
index 6fbee88..77f0247 100644
--- a/Src/params.c
+++ b/Src/params.c
@@ -535,10 +535,13 @@ scancopyparams(HashNode hn, UNUSED(int flags))
 HashTable
 copyparamtable(HashTable ht, char *name)
 {
-    HashTable nht = newparamtable(ht->hsize, name);
-    outtable = nht;
-    scanhashtable(ht, 0, 0, 0, scancopyparams, 0);
-    outtable = NULL;
+    HashTable nht = 0;
+    if (ht) {
+	nht = newparamtable(ht->hsize, name);
+	outtable = nht;
+	scanhashtable(ht, 0, 0, 0, scancopyparams, 0);
+	outtable = NULL;
+    }
     return nht;
 }
 
-- 
2.16.2

